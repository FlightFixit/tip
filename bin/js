#!/bin/bash

CMD=""

IFS="
"
for path in $(cat .../lib/java/cmds/utf8); do
    [ -e "$path" ] && {
        CMD="$path"
        break
    }
done

CP=""

# ToDo: Fix
SCRIPT="$1"
echo $(dirname $SCRIPT)

for jar in $(cat .../lib/rhino/jars/utf8); do
    pullhash "$jar"
    [ "$OSTYPE" == 'cygwin' ] && {
        echo "$CP"
        CP="$CP;$(cygpath -d "$jar")"
    } || {
        CP="$CP:$jar"
    }        
done

OPTS=""

## Fix for #512498
## Change Bootclasspath when using OpenJDK because OpenJDK6
## bundle his own release of Rhino.
## References:
## <https://bugs.launchpad.net/ubuntu/+source/openjdk-6/+bug/255149>
## <http://icedtea.classpath.org/bugzilla/show_bug.cgi?id=179>
## <http://www.openoffice.org/issues/show_bug.cgi?id=91641>
isOpenJDK=$($JAVA_CMD -version 2>&1 | grep -i "OpenJDK" | wc -l)
if [ $isOpenJDK -gt 0 ]; then
    OPTS="-Xbootclasspath:/usr/lib/jvm/java-6-openjdk/jre/lib/rt.jar"
fi

MAIN="org.mozilla.javascript.tools.shell.Main"

$CMD $OPTS -classpath $CP $MAIN "$@"
