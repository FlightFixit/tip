$( function() {
    $('input').each( function( idx, input ) {
        var $input = $(input)
        $input.val( localStorage[ $input.attr( 'name' ) ] )
    } )
  
    function save() {
        var status = ""
        $input.each( function( idx, input ) {
            var $input = $(input)
            var name = $input.attr( 'name' )
            var val = $input.val()

            var current = localStorage[ name ]

            if( val != current ) {
                localStorage[ name ] = val
                status += ( ( status.length > 0 ? '\n' : '' )
                            + '"' + name + '" set to: ' + val )
            }
        } )
        if( status.length > 0 ) {
            // ToDo: Generate HTML <ul/>
            // http://www.chromium.org/developers/design-documents/desktop-notifications/api-specification
            //webkitNotifications.createHTMLNotification( 'notification.html' )

            var notification = webkitNotifications.createNotification(
                chrome.extension.getURL( 'icon/48/png' ),
                'Property Changed',
                stauts
            )
            notification.show()
                    
            setTimeout( function() {
                notification.cancel()
            }, 5000 )
        }
    }

    $('form').submit( save )
} )

